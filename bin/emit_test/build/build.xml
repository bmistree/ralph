<project name="RalphEmitTest" default="compile" basedir=".">
  
  <description>
    Test cases for java libraries.
  </description>

  <dirname
    property="emit_test_dir"
    file="${ant.file.RalphJavaLibTest}"
  />
    
  <!-- global properties for this build file -->
  <property name="build.dir" location="${emit_test_dir}/classes"/>
  <property name="ralph_src.dir" location="${emit_test_dir}/../ralph_src"/>
  <property name="ralph_emitted.dir" location="${emit_test_dir}/../ralph_emitted"/>
  <property name="test_src.dir" location="${emit_test_dir}/../emit_test_harnesses"/>
  <property
      name="lib_build_path"
      location="${emit_test_dir}/../../../ralph/java_lib/build"/>
  <property
      name="lib_class_path" location="${lib_build_path}/classes/"/>
  <property
      name="proto_class_path" location="${lib_build_path}/../protobuf-java-2.4.1.jar"/>
  <property name="ralph_compiler_py" location="${emit_test_dir}/../../emit_file.py"/>

  <property name="emitted_package" value="ralph_emitted"/>
  
  <!-- set up build directories for test -->
  <target name="init" description="setup build directories">
    <echo message="Setting up build directories for tests"/>
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${ralph_emitted.dir}"/>
  </target>


  <!-- Compile an individual rph file -->
  <target
      name="compile_ralph"
      description="Compile ralph">
    <echo message="${line.separator}${rph_filename}${line.separator}"/>
    <exec executable="python" failonerror="true">
      <arg line="${ralph_compiler_py}"/>
      <arg line="-i ${ralph_src.dir}/${rph_filename}"/>
      <arg line="-o ${ralph_emitted.dir}/${class_name}.java"/>
      <arg line="-p ${emitted_package}"/>
      <arg line="-c ${class_name}"/>
    </exec>
  </target>

  <!-- Compilation for each ralph file -->
  <target name="iface_basic_ralph" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="iface_basic_ralph.rph"/>
      <param name="class_name" value="IFaceBasicRalphJava"/>
    </antcall>
  </target>

  <target name="multiple_interfaces" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="multiple_interfaces.rph"/>
      <param name="class_name" value="MultipleInterfacesJava"/>
    </antcall>
  </target>

  <target name="serialize_struct_with_list" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="serialize_struct_with_list.rph"/>
      <param name="class_name" value="SerializeStructWithListJava"/>
    </antcall>
  </target>
  
  <target name="serialize_struct_with_map" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="serialize_struct_with_map.rph"/>
      <param name="class_name" value="SerializeStructWithMapJava"/>
    </antcall>
  </target>

  <target name="serialize_map_of_structs" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="serialize_map_of_structs.rph"/>
      <param name="class_name" value="SerializeMapOfStructsJava"/>
    </antcall>
  </target>
    
  <target name="struct_serialization" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="struct_serialization.rph"/>
      <param name="class_name" value="StructSerializationJava"/>
    </antcall>
  </target>

  <target name="less_simplified_backed_speculation" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="less_simplified_backed_speculation.rph"/>
      <param name="class_name" value="LessSimplifiedBackedSpeculationJava"/>
    </antcall>
  </target>

  <target name="serialize_num_map" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="serialize_num_map.rph"/>
      <param name="class_name" value="SerializeNumMapJava"/>
    </antcall>
  </target>

  <target name="struct_list_serialization" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="struct_list_serialization.rph"/>
      <param name="class_name" value="StructListSerializationJava"/>
    </antcall>
  </target>

  <target name="serialize_text_list" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="serialize_text_list.rph"/>
      <param name="class_name" value="SerializeTextListJava"/>
    </antcall>
  </target>

  <target name="serialize_true_false_list" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="serialize_true_false_list.rph"/>
      <param name="class_name" value="SerializeTrueFalseListJava"/>
    </antcall>
  </target>

  <target name="basic_ralph" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="basic_ralph.rph"/>
      <param name="class_name" value="BasicRalphJava"/>
    </antcall>
  </target>

  <target name="internal_method_call" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="internal_method_call.rph"/>
      <param name="class_name" value="InternalMethodCallJava"/>
    </antcall>
  </target>

  <target name="ralph_atomically" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="ralph_atomically.rph"/>
      <param name="class_name" value="RalphAtomicallyJava"/>
    </antcall>
  </target>

  <target name="basic_partner" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="basic_partner.rph"/>
      <param name="class_name" value="BasicPartnerJava"/>
    </antcall>
  </target>

  <target name="test_map" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="test_map.rph"/>
      <param name="class_name" value="TestMapJava"/>
    </antcall>
  </target>

  <target name="atomic_map" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="atomic_map.rph"/>
      <param name="class_name" value="AtomicMapJava"/>
    </antcall>
  </target>

  <target name="struct_test" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="struct_test.rph"/>
      <param name="class_name" value="StructTestJava"/>
    </antcall>
  </target>

  <target name="nested_structs" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="nested_structs.rph"/>
      <param name="class_name" value="NestedStructsJava"/>
    </antcall>
  </target>

  <target name="test_list" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="test_list.rph"/>
      <param name="class_name" value="TestListJava"/>
    </antcall>
  </target>
  

  <target name="atomic_list" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="atomic_list.rph"/>
      <param name="class_name" value="AtomicListJava"/>
    </antcall>
  </target>
  

  <target name="for_list" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="for_list.rph"/>
      <param name="class_name" value="ForListJava"/>
    </antcall>
  </target>

  <target name="for_map" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="for_map.rph"/>
      <param name="class_name" value="ForMapJava"/>
    </antcall>
  </target>

  <target name="struct_lib" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="struct_lib.rph"/>
      <param name="class_name" value="StructLibJava"/>
    </antcall>
  </target>

  <target name="struct_lib_user" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="struct_lib_user.rph"/>
      <param name="class_name" value="StructLibUserJava"/>
    </antcall>
  </target>

  <target name="interrupted_atomically" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="interrupted_atomically.rph"/>
      <param name="class_name" value="InterruptedAtomicallyJava"/>
    </antcall>
  </target>

  <target name="endpoint_lib_user" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="endpoint_lib_user.rph"/>
      <param name="class_name" value="EndpointLibUserJava"/>
    </antcall>
  </target>

  <target name="interrupted_endpoint_atomically" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="interrupted_endpoint_atomically.rph"/>
      <param name="class_name" value="InterruptedEndpointAtomicallyJava"/>
    </antcall>
  </target>

  <target name="promotion" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="promotion.rph"/>
      <param name="class_name" value="PromotionJava"/>
    </antcall>
  </target>

  <target name="promotion" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="super_interrupted_atomically.rph"/>
      <param name="class_name" value="SuperInterruptedAtomicallyJava"/>
    </antcall>
  </target>

  <target name="hardware_failure" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="hardware_failure.rph"/>
      <param name="class_name" value="HardwareFailureJava"/>
    </antcall>
  </target>

  <target name="return_list" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="return_list.rph"/>
      <param name="class_name" value="ReturnListJava"/>
    </antcall>
  </target>

  <target name="atomic_partner" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="atomic_partner.rph"/>
      <param name="class_name" value="AtomicPartnerJava"/>
    </antcall>
  </target>

  <target name="many_ops_atomic_list_fail" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="many_ops_atomic_list_fail.rph"/>
      <param name="class_name" value="ManyOpsAtomicListFailJava"/>
    </antcall>
  </target>

  <target name="atomic_list_append" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="atomic_list_append.rph"/>
      <param name="class_name" value="AtomicListAppendJava"/>
    </antcall>
  </target>

  <target name="endpoint_struct_list" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="endpoint_struct_list.rph"/>
      <param name="class_name" value="EndpointStructListJava"/>
    </antcall>
  </target>

  <target name="wrapped_partner" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="wrapped_partner.rph"/>
      <param name="class_name" value="WrappedPartnerJava"/>
    </antcall>
  </target>

  <target name="linked_instance" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="linked_instance.rph"/>
      <param name="class_name" value="LinkedInstanceJava"/>
    </antcall>
  </target>
  
  <target name="linked_connection" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="linked_connection.rph"/>
      <param name="class_name" value="LinkedConnectionJava"/>
    </antcall>
  </target>
    
  <target name="single_side_service_factory" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="single_side_service_factory.rph"/>
      <param name="class_name" value="SingleSideServiceFactoryJava"/>
    </antcall>
  </target>

  <target name="partner_service_factory" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="partner_service_factory.rph"/>
      <param name="class_name" value="PartnerServiceFactoryJava"/>
    </antcall>
  </target>

  <target name="basic_speculation" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="basic_speculation.rph"/>
      <param name="class_name" value="BasicSpeculationJava"/>
    </antcall>
  </target>

  <target name="null" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="null.rph"/>
      <param name="class_name" value="NullJava"/>
    </antcall>
  </target>

  <target name="internal_create_service" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="internal_create_service.rph"/>
      <param name="class_name" value="InternalCreateServiceJava"/>
    </antcall>
  </target>
  
  <target name="self" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="self.rph"/>
      <param name="class_name" value="SelfJava"/>
    </antcall>
  </target>

  <target name="wrapped_iface" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="wrapped_iface.rph"/>
      <param name="class_name" value="WrappedIFaceJava"/>
    </antcall>
  </target>

  <target name="container_speculation" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="container_speculation.rph"/>
      <param name="class_name" value="ContainerSpeculationJava"/>
    </antcall>
  </target>

  <target name="range_test" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="range_test.rph"/>
      <param name="class_name" value="RangeTestJava"/>
    </antcall>
  </target>
  
  <target name="read_read_write_speculation" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="read_read_write_speculation.rph"/>
      <param name="class_name" value="ReadReadWriteSpeculationJava"/>
    </antcall>
  </target>

  <target name="interrupted_speculater" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="interrupted_speculater.rph"/>
      <param name="class_name" value="InterruptedSpeculaterJava"/>
    </antcall>
  </target>

  <target name="middle_interrupted_speculater" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="middle_interrupted_speculater.rph"/>
      <param name="class_name" value="MiddleInterruptedSpeculaterJava"/>
    </antcall>
  </target>

  <target name="backed_speculation" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="backed_speculation.rph"/>
      <param name="class_name" value="BackedSpeculationJava"/>
    </antcall>
  </target>

  <target name="atomic_struct.rph" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="atomic_struct.rph"/>
      <param name="class_name" value="AtomicStructJava"/>
    </antcall>
  </target>

  <target name="text_add_and_to_text" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="text_add_and_to_text.rph"/>
      <param name="class_name" value="TextAddAndToTextJava"/>
    </antcall>
  </target>

  <target name="lots_of_backouts" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="lots_of_backouts.rph"/>
      <param name="class_name" value="LotsOfBackoutsJava"/>
    </antcall>
  </target>
  
  <target name="multiline_string" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="multiline_string.rph"/>
      <param name="class_name" value="MultiLineStringJava"/>
    </antcall>
  </target>

  <target name="simplified_backed_speculation" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="simplified_backed_speculation.rph"/>
      <param name="class_name" value="SimplifiedBackedSpeculationJava"/>
    </antcall>
  </target>
  
  <target name="serialize_number_list" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="serialize_number_list.rph"/>
      <param name="class_name" value="SerializeNumberListJava"/>
    </antcall>
  </target>
  
  <target name="partner_number_return" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="partner_number_return.rph"/>
      <param name="class_name" value="PartnerNumberReturnJava"/>
    </antcall>
  </target>
  
  <target name="internal_return_struct" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="internal_return_struct.rph"/>
      <param name="class_name" value="InternalReturnStructJava"/>
    </antcall>
  </target>
  
  <target name="reference_service_factory" depends="init" description="translate ralph files">
    <antcall target="compile_ralph">
      <param name="rph_filename" value="reference_service_factory.rph"/>
      <param name="class_name" value="ReferenceServiceFactoryJava"/>
    </antcall>
  </target>

  

  <!-- COMPILING -->
  <!-- compile java libraries -->
  <target name="compile_libs" depends="init" description="compile library files">
    <ant antfile="${lib_build_path}/build.xml" target="compile_all" />  
  </target>


  
  <target name="ralph_to_byte_code" depends="init,compile_libs" description="compile ralph files">
    <!-- Compile all ralph java to bytecode -->
    <javac
        srcdir="${ralph_emitted.dir}"
        destdir="${build.dir}"
        classpath="${lib_class_path}:${proto_class_path}"
        debug="true"
        debuglevel="lines,vars,source"
        includeantruntime="false" />
  </target>

    
  <!-- compile ralph endpoints to java programs, including translating -->
  <target
      name="compile_ralph"
      depends="init,compile_libs,translate_ralph,ralph_to_byte_code"
      description="compile ralph files">
  </target>

  <target
      name="compile_ralph_tests"
      depends="init,compile_ralph"
      description="compile basic ralph">
    <!-- compile all ralph tests  -->
    <javac
        srcdir="${test_src.dir}"
        destdir="${build.dir}"
        classpath="${build.dir}"
        debug="true"
        debuglevel="lines,vars,source"
        includeantruntime="false" />
  </target>

  <!-- RUNNING TESTS -->
  <target
      name="run_all"
      depends=
        "run_BasicSetterGetter, run_BasicInternalMethodCall,
         run_BasicTestAtomically,run_BasicPartnerCall,run_MapTest,
         run_AtomicMapTest,run_StructSetterGetter,run_NestedStructTest,
         run_ListTest,run_AtomicListTest,run_ForListTest,run_ForMapTest,
         run_StructLibraries,run_InterruptedAtomically,run_EndpointCalls,
         run_InterruptedEndpointCallAtomically,run_PromotionTest,
         run_SuperInterruptedAtomically,run_HardwareFailure,run_ReturnList,
         run_WoundWait,run_TCPPartnerCall,run_AtomicPartnerCall,
         run_AtomicTCPPartnerCall,run_RandomFailureExtendedList,
         run_WrappedPartnerTCPCall,run_LinkedTests,run_SingleSideServiceFactory,
         run_PartnerServiceFactory,run_EndpointStructListTest,run_BasicSpeculation,
         run_NullTest,run_InternalCreateService,run_Self,run_ContainerSpeculation,
         run_Range,run_ReadReadWriteSpeculation,run_InterruptedSpeculaterTest,
         run_MiddleInterruptedSpeculaterTest,run_AlwaysWorksBackedSpeculationTest,
         run_RandomDelaysAlwaysWorksBackedSpeculationTest,
         run_RandomFailuresBackedSpeculationTest, run_AtomicStructTest,
         run_TextManipulation,run_LotsOfBackouts,
         run_TimedAlwaysWorksBackedSpeculationTest,
         run_SimplifiedTimedSpeculationTest, run_PartnerCallReturn,
         run_SerializeNumberListTest,run_SerializeTextListTest,
         run_SerializeTrueFalseListTest,run_SerializeStructTest,
         run_ListOfStructsSerializationTest,run_LessSimplifiedTimedBackedSpeculation,
         run_SerializeNumberNumberMapTest,run_SerializeMapOfStructs,
         run_InternalStructMethodCallTest,run_ReferenceServiceFactoryTest,
         run_MultipleInterfacesTest,run_SerializeStructWithMap,
         run_SerializeStructWithList">
  </target>
    
  
  <!-- Single side setter getter -->
  <target
      name="run_BasicSetterGetter"
      depends="compile_ralph_tests"
      description="Single side setter getter test.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.BasicSetterGetter"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Struct setter getter -->
  <target
      name="run_StructSetterGetter"
      depends="compile_ralph_tests"
      description="Setters and getters on struct fields test.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.StructSetterGetter"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>
  
  <!-- Internal method call on single host -->
  <target
      name="run_BasicInternalMethodCall"
      depends="compile_ralph_tests"
      description="Single side internal method call.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.BasicInternalMethodCall"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Atomically change -->
  <target
      name="run_BasicTestAtomically"
      depends="compile_ralph_tests"
      description="Test nested atomically-s.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.BasicTestAtomically"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>
  

  <!-- Partner call -->
  <target
      name="run_BasicPartnerCall"
      depends="compile_ralph_tests"
      description="Test calling partner methods.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.BasicPartnerCall"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>
  
  <!-- TCP partner call -->
  <target
      name="run_TCPPartnerCall"
      depends="compile_ralph_tests"
      description="Test calling partner methods over TCP.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.TCPPartnerCall"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  
  <!-- MapTesting -->
  <target
      name="run_MapTest"
      depends="compile_ralph_tests"
      description="Test map methods.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.MapTester"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>
  
  <!-- Atomic map test -->
  <target
      name="run_AtomicMapTest"
      depends="compile_ralph_tests"
      description="Test atomic map methods.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.AtomicMapTester"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- ListTesting -->
  <target
      name="run_ListTest"
      depends="compile_ralph_tests"
      description="Test list methods.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.ListTester"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- AtomicListTesting -->
  <target
      name="run_AtomicListTest"
      depends="compile_ralph_tests"
      description="Test atomic list methods.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.AtomicListTester"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Nested struct test -->
  <target
      name="run_NestedStructTest"
      depends="compile_ralph_tests"
      description="Test nested struct.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.NestedStructs"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- For list test -->
  <target
      name="run_ForListTest"
      depends="compile_ralph_tests"
      description="Test for loop on lists.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.ForList"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- For map test -->
  <target
      name="run_ForMapTest"
      depends="compile_ralph_tests"
      description="Test for loop on maps.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.ForMap"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Struct libraries -->
  <target
      name="run_StructLibraries"
      depends="compile_ralph_tests"
      description="Tests that can import a struct from another library.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.StructLibraries"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>


  <!-- Run interrupted atomically -->
  <target
      name="run_InterruptedAtomically"
      depends="compile_ralph_tests"
      description="Tests that handles atomic events' being interrupted.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.InterruptedTestAtomically"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  
  <!-- Run endpoint calls -->
  <target
      name="run_EndpointCalls"
      depends="compile_ralph_tests"  
      description="Tests issue endpoint calls from within ralph.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.EndpointCalls"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>
  
  <!-- Run interrupted endpoint calls -->
  <target
      name="run_InterruptedEndpointCallAtomically"
      depends="compile_ralph_tests"  
      description="Tests ensure atomically wrapper between endpoint calls works.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.InterruptedEndpointCallAtomically"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run promotion test -->
  <target
      name="run_PromotionTest"
      depends="compile_ralph_tests"
      description="Tests quality of service through promotions.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.PromotionTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run super event priority test -->
  <target
      name="run_SuperInterruptedAtomically"
      depends="compile_ralph_tests"
      description="Tests that can run with super priority.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SuperInterruptedTestAtomically"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run hardware failure test -->
  <target
      name="run_HardwareFailure"
      depends="compile_ralph_tests"
      description="Tests that system can handle hardware failures.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.HardwareFailureTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run return list -->
  <target
      name="run_ReturnList"
      depends="compile_ralph_tests"
      description="Tests that can return a list.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.ReturnListTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run wound wait test -->
  <target
      name="run_WoundWait"
      depends="compile_ralph_tests"
      description="Tests that wound/wait works.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.WoundWaitTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>


  <!-- Run atomic partner call -->
  <target
      name="run_AtomicPartnerCall"
      depends="compile_ralph_tests"
      description="Tests that can make atomic partner calls.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.AtomicPartnerCall"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run TCP atomic partner call -->
  <target
      name="run_AtomicTCPPartnerCall"
      depends="compile_ralph_tests"
      description="Tests that can make atomic partner calls over TCP.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.AtomicTCPPartnerCall"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>


  <!-- Run RandomFailureExtendedList -->
  <target
      name="run_RandomFailureExtendedList"
      depends="compile_ralph_tests"
      description="Tests that can make atomic partner calls over TCP.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.RandomFailureExtendedList"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run AtomicListAppendTest -->
  <target
      name="run_AtomicListAppend"
      depends="compile_ralph_tests"
      description="Ensures append works on atomic lists.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.AtomicListAppendTester"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run WrappedPartnerTCPCall   -->
  <target
      name="run_WrappedPartnerTCPCall"
      depends="compile_ralph_tests"
      description="Can make a tcp call from endpoint call.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.WrappedTCPPartnerCall"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run LinkedTests -->
  <target
      name="run_LinkedTests"
      depends="compile_ralph_tests"
      description="Can make a mixture of endpoint and partner calls and still complete.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.LinkedTests"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>


  <!-- Run SingleSideServiceFactory -->
  <target
      name="run_SingleSideServiceFactory"
      depends="compile_ralph_tests"
      description="Run service factory">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SingleSideServiceFactoryTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run PartnerServiceFactory -->
  <target
      name="run_PartnerServiceFactory"
      depends="compile_ralph_tests"
      description="Run partner service factory">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.PartnerSendServiceFactoryTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>


  <!-- Run EndpointStructListTest -->
  <target
      name="run_EndpointStructListTest"
      depends="compile_ralph_tests"
      description="Run endpoint struct list test">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.EndpointStructListTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>        
  
  <!-- Run BasicSpeculation -->
  <target
      name="run_BasicSpeculation"
      depends="compile_ralph_tests"
      description="Run basic speculation test.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.BasicSpeculationTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run NullTest -->
  <target
      name="run_NullTest"
      depends="compile_ralph_tests"
      description="Run basic null test.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.NullTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run InternalCreateService -->
  <target
      name="run_InternalCreateService"
      depends="compile_ralph_tests"
      description="Run internal create service.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.InternalCreateServiceTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>


  <!-- Run SelfTest -->
  <target
      name="run_Self"
      depends="compile_ralph_tests"
      description="Run self.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SelfTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>


  <!-- Run ContainerSpeculationTest -->
  <target
      name="run_ContainerSpeculation"
      depends="compile_ralph_tests"
      description="Run container speculation.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.ContainerSpeculationTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>


  <!-- Run Range test -->
  <target
      name="run_Range"
      depends="compile_ralph_tests"
      description="Run range test.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.Range"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>        
    </java>
  </target>
  
  <!-- Run ReadReadWriteSpeculation test -->
  <target
      name="run_ReadReadWriteSpeculation"
      depends="compile_ralph_tests"
      description="Run read-read-write speculation.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.ReadReadWriteTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run InterruptedSpeculater test -->
  <target
      name="run_InterruptedSpeculaterTest"
      depends="compile_ralph_tests"
      description="Run a test where the root of speculation gets interrupted.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.InterruptedSpeculaterTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Run InterruptedSpeculater test -->
  <target
      name="run_MiddleInterruptedSpeculaterTest"
      depends="compile_ralph_tests"
      description="Run a test where an object in middle of speculation chain
                   gets interrupted.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.MiddleInterruptedSpeculaterTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Backed speculation test -->
  <target
      name="run_AlwaysWorksBackedSpeculationTest"
      depends="compile_ralph_tests"
      description="Run a test where we try to back a speculative with a
                   backing code.  Commits to hardware always succeed.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.AlwaysWorksBackedSpeculationTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Random delays backed speculation test -->
  <target
      name="run_RandomDelaysAlwaysWorksBackedSpeculationTest"
      depends="compile_ralph_tests"
      description="Run a test where we try to back a speculative with a
                   backing code.  Commits to hardware always succeed, but
                   take random times to commit">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.RandomDelaysAlwaysWorksBackedSpeculationTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>


  <!-- Random failures backed speculation test -->
  <target
      name="run_RandomFailuresBackedSpeculationTest"
      depends="compile_ralph_tests"
      description="Run a test where we try to back a speculative with a
                   backing code.  Commits to hardware randomly fail.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.RandomFailuresBackedSpeculationTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- AtomicFailures test -->
  <target
      name="run_AtomicStructTest"
      depends="compile_ralph_tests"
      description="Ensure that TVar on struct works correctly">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.AtomicStructTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- TextManipulation test -->
  <target
      name="run_TextManipulation"
      depends="compile_ralph_tests"
      description="Test concatenating strings and converting numbers to strings.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.TextManipulation"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- Lots of Backouts test -->
  <target
      name="run_LotsOfBackouts"
      depends="compile_ralph_tests"
      description="Test that always rollback state during backouts.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.LotsOfBackoutsTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- TimedAlwaysWorksBackedSpeculationTest -->
  <target
      name="run_TimedAlwaysWorksBackedSpeculationTest"
      depends="compile_ralph_tests"
      description="Test that speculation actually increases throughput.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.TimedAlwaysWorksBackedSpeculationTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- TimedAlwaysWorksBackedSpeculationTest -->
  <target
      name="run_SimplifiedTimedSpeculationTest"
      depends="compile_ralph_tests"
      description="Test that speculation actually increases
                   throughput on smaller test case than BackedSpeculation.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SimplifiedTimedSpeculationTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- PartnerCallReturn -->
  <target
      name="run_PartnerCallReturn"
      depends="compile_ralph_tests"
      description="Test that passing a value back to caller works.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.PartnerCallReturn"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- SerializeNumberListTest -->
  <target
      name="run_SerializeNumberListTest"
      depends="compile_ralph_tests"
      description="Test that can serialize a list of numbers.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SerializeNumberListTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- SerializeTextListTest -->
  <target
      name="run_SerializeTextListTest"
      depends="compile_ralph_tests"
      description="Test that can serialize a list of strings.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SerializeTextListTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- SerializeTrueFalseListTest -->
  <target
      name="run_SerializeTrueFalseListTest"
      depends="compile_ralph_tests"
      description="Test that can serialize a list of booleans.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SerializeTrueFalseListTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>
  
  <!-- SerializeStructTest -->
  <target
      name="run_SerializeStructTest"
      depends="compile_ralph_tests"
      description="Test that can serialize a struct.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.StructSerialization"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- ListOfStructsSerializationTest -->
  <target
      name="run_ListOfStructsSerializationTest"
      depends="compile_ralph_tests"
      description="Test that can serialize a list of structs.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.ListOfStructsSerialization"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- LessSimplifiedTimedBackedSpeculation -->
  <target
      name="run_LessSimplifiedTimedBackedSpeculation"
      depends="compile_ralph_tests"
      description="Test that can speuclate concurrently
                   on a less simplified test.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.LessSimplifiedTimedSpeculationTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- SerializeNumberNumberMapTest -->
  <target
      name="run_SerializeNumberNumberMapTest"
      depends="compile_ralph_tests"
      description="Test that can serialize a map whose
                   indices and values are numbers.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SerializeNumberNumberMapTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- SerializeMapOfStructsTest -->
  <target
      name="run_SerializeMapOfStructs"
      depends="compile_ralph_tests"
      description="Test that can serialize a map whose
                   indices are numbers and values are structs.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SerializeMapOfStructs"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- InternalStructMethodCallTest -->
  <target
      name="run_InternalStructMethodCallTest"
      depends="compile_ralph_tests"
      description="Tests that handles returning structs from methods">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.InternalStructMethodCallTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>
  
  <!-- ReferenceServiceFactoryTest -->
  <target
      name="run_ReferenceServiceFactoryTest"
      depends="compile_ralph_tests"
      description="Tests that can use servicereferences to construct
                   partnered endpoints">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.ReferenceServiceFactoryTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>

  <!-- MultipleInterfaceTest -->
  <target
      name="run_MultipleInterfacesTest"
      depends="compile_ralph_tests"
      description="Tests that can implement multiple interfaces on
                   a single endpoint.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.MultipleInterfacesTest"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>
  
  <!-- SerializeStructWithMap -->
  <target
      name="run_SerializeStructWithMap"
      depends="compile_ralph_tests"
      description="Tests that can serialize a struct
                   containing a map.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SerializeStructWithMap"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>
  
  <!-- SerializeStructWithList -->
  <target
      name="run_SerializeStructWithList"
      depends="compile_ralph_tests"
      description="Tests that can serialize a struct
                   containing a list.">
    <java
        dir="${build.dir}"
        classname="emit_test_harnesses.SerializeStructWithList"
        fork="yes"
        classpath="${build.dir}:${proto_class_path}">
        <arg line="${args}"/>
        <jvmarg value="-ea"/>
    </java>
  </target>
  
  <!-- Delete the build directories -->
  <target name="clean" description="get rid of build dir">
    <delete dir="${build.dir}"/>
    <delete dir="${ralph_emitted.dir}"/>
    <!-- Delete ralph compiler output -->
    <delete file="parser.out"/>
    <delete file="parsetab.py"/>
    
  </target>

  <target
      name="clean_all"
      depends="clean"
      description="get rid of build dir and all built libs">
    
    <ant antfile="${lib_build_path}/build.xml" target="clean" />
    
  </target>
</project>
